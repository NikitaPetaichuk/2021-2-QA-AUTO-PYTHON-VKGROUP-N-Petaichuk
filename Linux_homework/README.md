# Скрипт на Python: nginx_log_parser.py

Данный скрипт предназначен для анализа access_log HTTP-сервера nginx.
Пример использования:

```shell
foo@bar:~$ python3 nginx_log_parser.py access.log
```

Для получения справки по возможным командам необходиом использовать флаг -h:

```shell
foo@bar:~$ python3 nginx_log_parser.py -h
```

Результаты будут выводиться в файл NLP_result.txt. При использовании флага --json результат будет записываться в файл NLP_result.json в формате JSON.

## Варианты использования

### 1. Подсчёт общего количества запросов

Для подсчёта числа запросов используется флаг --count:

```shell
foo@bar:~$ python3 nginx_log_parser.py --count access.log
```

Также подсчёт числа запросов является поведением по умолчанию (баз указания флагов будет считаться только число запросов).

Результат работы:
* В обычном файле:
```text
Общее количество запросов:
225133
```
* В формате JSON:
```json
{
  "count": 225133
}
```

### 2. Подсчёт общего количества запросов по типу

Для подсчёта числа запросов используется флаг --methods-count:

```shell
foo@bar:~$ python3 nginx_log_parser.py --methods-count access.log
```

В случае, если на месте метода в файле лога будет неизвестный HTTP метод, то он будет выделен в категорию UNDEFINED.

Результат работы:
* В обычном файле:
```text
Общее количество запросов по типу:
POST - 102503
GET - 122095
...
```
* В формате JSON:
```json
{
  "methods_count": [
    {
      "method": "GET",
      "count": 1
    }
  ]
}
```

### 3. Топ 10 самых частых запросов

Для вывода топа 10 самых частых запросов используется флаг --top-10-popular-requests

```shell
foo@bar:~$ python3 nginx_log_parser.py --top-10-popular-requests access.log
```


Результат работы:
* В обычном файле:
```text
Топ 10 самых частых запросов:
'/administrator/index.php' - 103932
'/apache-log/access.log' - 26336
...
```
* В формате JSON:
```json
{
  "most_popular_requests": [
    {
      "url": "/administrator/index.php",
      "count": 100000
    }
  ]
}
```

### 4. Топ 5 самых больших по размеру запросов, которые завершились клиентской (4ХХ) ошибкой

Для вывода топа 5 самых больших по размеру запросов, которые завершились клиентской (4ХХ) ошибкой, используется флаг --top-5-biggest-4XX-requests:

```shell
foo@bar:~$ python3 nginx_log_parser.py --top-5-biggest-4XX-requests access.log
```

Для запросов, у которых не указан размер, размер обозначается как -1.

Результат работы:
* В обычном файле:
```text
Топ 5 самых больших по размеру запросов, которые завершились клиентской (4ХХ) ошибкой:
'/index.php?option=com_phocagallery&view=category&id=4025&Itemid=53' - 404 - 1417 - 189.217.45.73
'/index.php?option=com_phocagallery&view=category&id=7806&Itemid=53' - 404 - 1417 - 189.217.45.73
...
```
* В формате JSON:
```json
{
  "biggest_4xx_requests": [
    {
      "url": "/administrator/index.php",
      "status": 404,
      "size": 2000,
      "ip": "127.0.0.1"
    }
  ]
}
```

### 5. Топ 5 пользователей по количеству запросов, которые завершились серверной (5ХХ) ошибкой

Для вывода топа 5 пользователей по количеству запросов, которые завершились серверной (5ХХ) ошибкой, используется флаг --top-5-5XX-requests-ips

```shell
foo@bar:~$ python3 nginx_log_parser.py --top-5-5XX-requests-ips access.log
```

Результат работы:
* В обычном файле:
```text
Топ 5 пользователей по количеству запросов, которые завершились серверной (5ХХ) ошибкой:
'189.217.45.73' - 225
'82.193.127.15' - 4
...
```
* В формате JSON:
```json
{
  "popular_5xx_ips": [
    {
      "ip": "127.0.0.1",
      "count": 6969
    }
  ]
}
```

### Иные варианты использования

В случае, если хочется получить всю информацию о логе, то можно использовать флаг --all:

```shell
foo@bar:~$ python3 nginx_log_parser.py --all access.log
```

## Достойнства

* Более гибкая работа с логом.

## Недостатки

* Требует написания большего числа кода.
* Работает медленнее по сравнению с bash-скриптами.


# Скрипты на bash

Скрипты, которые лежат в папке bash_scripts, предназначены для решения тех же задач, что и nginx_log_parser.py, только каждый скрипт отвечает за решение конкретной задачи.

## Варианты использования

### 1. Подсчёт общего количества запросов

Для подсчёта общего числа запросов используется скрипт get_requests_count.sh:

```shell
foo@bar:~$ ./bash_scripts/get_requests_count.sh access.log
```

Результат записывается в файл bash_count_output.txt:
```text
Общее количество запросов:
225133
```

### 2. Подсчёт общего количества запросов по типу

Для подсчёта общего количества запросов по типу используется скрипт get_methods_count.sh:

```shell
foo@bar:~$ ./bash_scripts/get_methods_count.sh access.log
```

В случае, если на месте метода не находится HTTP метод, то он определяется как UNDEFINED.

Результат записывается в файл bash_MC_output.txt в следующем формате:
```text
Общее количество запросов по типу:
'METHOD1' - 'COUNT1'
'METHOD2' - 'COUNT2'
...
```

### 3. Топ 10 самых частых запросов

Для вывода топа 10 самых частых запросов используется скрипт get_most_popular_requests.sh:

```shell
foo@bar:~$ ./bash_scripts/get_most_popular_requests.sh access.log
```

Результат записывается в файл bash_10_MPR_output.txt в следующем формате:
```text
Топ 10 самых частых запросов:
'URL1'
'COUNT1'

'URL2'
'COUNT2'

...
```

### 4. Топ 5 самых больших по размеру запросов, которые завершились клиентской (4ХХ) ошибкой

Для вывода топа 5 самых больших по размеру запросов, которые завершились клиентской (4ХХ) ошибкой, используется скрипт get_5_biggest_4xx_requests.sh:

```shell
foo@bar:~$ ./bash_scripts/get_5_biggest_4xx_requests.sh access.log
```

Результат записывается в файл bash_5_BR_4XX_output.txt в следующем формате:
```text
Топ 5 самых больших по размеру запросов, которые завершились клиентской (4ХХ) ошибкой:
'URL1'
'STATUS1'
'SIZE1'
'IP1'

'URL2'
'STATUS2'
'SIZE2'
'IP2'

...
```

### 5. Топ 5 пользователей по количеству запросов, которые завершились серверной (5ХХ) ошибкой

Для вывода топа 5 пользователей по количеству запросов, которые завершились серверной (5ХХ) ошибкой, используется скрипт get_5_biggest_4xx_requests.sh:

```shell
foo@bar:~$ ./bash_scripts/get_5_biggest_4xx_requests.sh access.log
```

Результат записывается в файл bash_5_BR_4XX_output.txt в следующем формате:
```text
Топ 5 пользователей по количеству запросов, которые завершились серверной (5ХХ) ошибкой:
'IP1'
'COUNT1'

'IP2'
'COUNT2'

...
```

## Достойнства

* Меньше временных затрат на написание скрипта.
* Скрипты выполняются быстрее, чем скрипт на Python.

## Недостатки

* Менее гибкая обработка данных (скрипт представляет из себя взаимодействующие между собой программы).